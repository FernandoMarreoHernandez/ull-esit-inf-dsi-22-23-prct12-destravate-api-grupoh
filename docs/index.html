<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh</title><meta name="description" content="Documentation for ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<h2>ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh</h2></div>
<div class="tsd-panel tsd-typography">
<a href="#práctica-api-rest" id="práctica-api-rest" style="color: inherit; text-decoration: none;">
  <h1>Práctica API REST</h1>
</a>
<p><a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/coveralls.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/coveralls.yml/badge.svg" alt="Coveralls"></a>
<a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/node.js.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/node.js.yml/badge.svg" alt="Tests"></a>
<a href="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/sonarcloud.yml"><img src="https://github.com/ULL-ESIT-INF-DSI-2223/ull-esit-inf-dsi-22-23-prct12-destravate-api-grupoh/actions/workflows/sonarcloud.yml/badge.svg" alt="Sonar-Cloud"></a></p>

<a href="#introducción" id="introducción" style="color: inherit; text-decoration: none;">
  <h2>Introducción</h2>
</a>
<p>En esta práctica se nos pide crear un API REST el cuál use como base de datos mongoose. También se nos pide usar async/await. Se nos pide realizar una api que permita realizar peticiones get, patch, post y delete, en este caso para una aplicación de información deportiva.</p>

<a href="#implementación" id="implementación" style="color: inherit; text-decoration: none;">
  <h2>Implementación</h2>
</a>
<p>Para la implementación hemos dividido el proyecto en una carpeta para las interfaz y modelos, un fichero para cada cosa (ruta, usuario, grupo y reto), luego un directorio con los routers de cada uno de ellos y luego el fichero app y el index.API</p>

<a href="#implementación-de-las-interfaces-y-modelos" id="implementación-de-las-interfaces-y-modelos" style="color: inherit; text-decoration: none;">
  <h3>Implementación de las interfaces y modelos</h3>
</a>

<a href="#usuario" id="usuario" style="color: inherit; text-decoration: none;">
  <h4>Usuario</h4>
</a>
<p>Para la interfaz y el modelo de usuario hemos creado lo siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">nombre</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas</span><span class="hl-1"> : </span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">retos_activos</span><span class="hl-1"> : </span><span class="hl-3">RetoDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">amigos</span><span class="hl-1"> : </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">grupos</span><span class="hl-1">: </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[][];</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][];</span><br/><span class="hl-1">  </span><span class="hl-4">actividad</span><span class="hl-1"> : </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;bicicleta y correr&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][][];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">UsuarioSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-7">match</span><span class="hl-1">(</span><span class="hl-8">/</span><span class="hl-9">^</span><span class="hl-10">[</span><span class="hl-8">A-Z</span><span class="hl-10">]</span><span class="hl-8">/</span><span class="hl-1">)){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El nombre debe comezar por una letra mayúscula&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Rutas&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutacheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">rutacheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La ruta no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">retos_activos :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Retos&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">retocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El reto no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">amigos :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">amigo</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">amigocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">amigo</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">amigocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;no puedes añadir a un amigo que no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">grupos :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">]],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[][]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">usuariocheck</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;no puedes añadir a un amigo que no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[</span><span class="hl-4">Number</span><span class="hl-1">]],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">actividad :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">enum :</span><span class="hl-1"> [</span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;correr&quot;</span><span class="hl-1">, </span><span class="hl-5">&quot;bicicleta y correr&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[[</span><span class="hl-4">Number</span><span class="hl-1">]]],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][][]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">].</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">].</span><span class="hl-4">length</span><span class="hl-1"> != </span><span class="hl-11">2</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El historico de rutas debe tener 2 arrays dentro del segundo array&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">] &gt; </span><span class="hl-11">31</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">] &lt; </span><span class="hl-11">1</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El dia debe estar entre 1 y 31&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">1</span><span class="hl-1">] &gt; </span><span class="hl-11">12</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">1</span><span class="hl-1">] &lt; </span><span class="hl-11">1</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El mes debe estar entre 1 y 12&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">2</span><span class="hl-1">] &gt; </span><span class="hl-11">2023</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">2</span><span class="hl-1">] &lt; </span><span class="hl-11">2000</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El año debe estar entre 2000 y 2023&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Usuario</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">, </span><span class="hl-4">UsuarioSchema</span><span class="hl-1">);</span>
</code></pre>
<p>En este código creamos la interfaz de usuario con los campos necesarios. En el modelo de usuario creamos el esquema de usuario con los campos necesarios y las validaciones necesarias. En este caso hemos usado el validate para comprobar que los campos de los arrays de ids de los amigos y grupos existen en la base de datos. También hemos usado el validate para comprobar que el historico de rutas tiene el formato correcto.</p>

<a href="#ruta" id="ruta" style="color: inherit; text-decoration: none;">
  <h4>Ruta</h4>
</a>
<p>La implementación de la interfaz y el modelo de ruta es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">nombre</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">geolocalizacion_inicio</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">geolocalizacion_fin</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">longitud</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">desnivel</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios</span><span class="hl-1"> : </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">tipo</span><span class="hl-1"> : </span><span class="hl-5">&quot;bicicleta&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;corriendo&quot;</span><span class="hl-1"> | </span><span class="hl-5">&quot;bicicleta y corriendo&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">calificacion</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">RutaSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-7">match</span><span class="hl-1">(</span><span class="hl-8">/</span><span class="hl-9">^</span><span class="hl-10">[</span><span class="hl-8">A-Z</span><span class="hl-10">]</span><span class="hl-8">/</span><span class="hl-1">)){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El nombre debe comezar por una letra mayúscula&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">geolocalizacion_inicio :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Number</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> != </span><span class="hl-11">2</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La geolocalización debe tener dos valores&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">geolocalizacion_fin :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Number</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> != </span><span class="hl-11">2</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La geolocalización debe tener dos valores&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">longitud :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La longitud debe ser positiva&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">desnivel :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El desnivel debe ser positivo&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuario&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">usuariocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El usuario no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1"> != </span><span class="hl-5">&#39;bicicleta&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">value</span><span class="hl-1"> != </span><span class="hl-5">&#39;corriendo&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">value</span><span class="hl-1"> != </span><span class="hl-5">&#39;bicicleta y corriendo&#39;</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El tipo debe ser bicicleta, corriendo o bicicleta y corriendo&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">calificacion:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-11">0</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1"> &gt; </span><span class="hl-11">10</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La calificación debe ser un número entre 0 y 10&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Ruta</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Ruta&#39;</span><span class="hl-1">, </span><span class="hl-4">RutaSchema</span><span class="hl-1">);</span>
</code></pre>
<p>En este código creamos la interfaz de ruta con los campos necesarios. En el modelo de ruta creamos el esquema de ruta con los campos necesarios y las validaciones necesarias. En este caso hemos usado el validate para comprobar que los campos de los arrays de ids de los usuarios existen en la base de datos.</p>

<a href="#reto" id="reto" style="color: inherit; text-decoration: none;">
  <h4>Reto</h4>
</a>
<p>La implementación de la interfaz y el modelo de reto es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">RetoDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">nombre</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">rutas</span><span class="hl-1"> : </span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">tipo</span><span class="hl-1"> : </span><span class="hl-5">&#39;corriendo&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;bicicleta&#39;</span><span class="hl-1"> | </span><span class="hl-5">&#39;corriendo y bicicleta&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">kilometros</span><span class="hl-1"> :</span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios</span><span class="hl-1"> : </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">RetoSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">RetoDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Rutas&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutacheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">rutacheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La ruta no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">tipo:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">kilometros:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">usuarios:</span><span class="hl-1">{</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">usuariocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El usuario no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Reto</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">RetoDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Reto&#39;</span><span class="hl-1">, </span><span class="hl-4">RetoSchema</span><span class="hl-1">);</span>
</code></pre>
<p>En este código creamos la interfaz de reto con los campos necesarios. En el modelo de reto creamos el esquema de reto con los campos necesarios y las validaciones necesarias. En este caso hemos usado el validate para comprobar que los campos de los arrays de ids de los usuarios y rutas existen en la base de datos.</p>

<a href="#grupo" id="grupo" style="color: inherit; text-decoration: none;">
  <h4>Grupo</h4>
</a>
<p>La implementación de la interfaz y el modelo de grupo es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-2">interface</span><span class="hl-1"> </span><span class="hl-3">GrupoDocumentInterface</span><span class="hl-1"> </span><span class="hl-2">extends</span><span class="hl-1"> </span><span class="hl-3">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">nombre</span><span class="hl-1"> : </span><span class="hl-3">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">participantes</span><span class="hl-1"> : </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][];</span><br/><span class="hl-1">  </span><span class="hl-4">clasificacion</span><span class="hl-1"> : </span><span class="hl-3">UsuarioDocumentInterface</span><span class="hl-1">[][];</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas</span><span class="hl-1"> : </span><span class="hl-3">RutaDocumentInterface</span><span class="hl-1">[];</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][][];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">GrupoSchema</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-3">GrupoDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique :</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">nombre :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">unique :</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">participantes :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">usuariocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El usuario no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">estadisticas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[</span><span class="hl-4">Number</span><span class="hl-1">]],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">clasificacion :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">]],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Usuarios&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuariocheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">usuariocheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El usuario no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">rutas_favoritas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [</span><span class="hl-4">Schema</span><span class="hl-1">.</span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">ref :</span><span class="hl-1"> </span><span class="hl-5">&#39;Rutas&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">SchemaType</span><span class="hl-1">[]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">for</span><span class="hl-1">(</span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> </span><span class="hl-2">of</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutacheck</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">rutacheck</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;La ruta no existe&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">historico_rutas :</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">type :</span><span class="hl-1"> [[[</span><span class="hl-4">Number</span><span class="hl-1">]]],</span><br/><span class="hl-1">    </span><span class="hl-4">required :</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-7">validate</span><span class="hl-4"> :</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> : </span><span class="hl-3">number</span><span class="hl-1">[][][]) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">        </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">].</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-11">0</span><span class="hl-1">){</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">].</span><span class="hl-4">length</span><span class="hl-1"> != </span><span class="hl-11">2</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El historico de rutas debe tener 2 arrays dentro del segundo array&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">] &gt; </span><span class="hl-11">31</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">] &lt; </span><span class="hl-11">1</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El dia debe estar entre 1 y 31&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">1</span><span class="hl-1">] &gt; </span><span class="hl-11">12</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">1</span><span class="hl-1">] &lt; </span><span class="hl-11">1</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El mes debe estar entre 1 y 12&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">2</span><span class="hl-1">] &gt; </span><span class="hl-11">2023</span><span class="hl-1"> || </span><span class="hl-4">value</span><span class="hl-1">[</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">0</span><span class="hl-1">][</span><span class="hl-11">2</span><span class="hl-1">] &lt; </span><span class="hl-11">2000</span><span class="hl-1">){</span><br/><span class="hl-1">            </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-5">&#39;El año debe estar entre 2000 y 2023&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">Grupo</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-3">GrupoDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-5">&#39;Grupo&#39;</span><span class="hl-1">, </span><span class="hl-4">GrupoSchema</span><span class="hl-1">);</span>
</code></pre>

<a href="#implementación-de-los-routers" id="implementación-de-los-routers" style="color: inherit; text-decoration: none;">
  <h3>Implementación de los routers</h3>
</a>
<p>En la implementación de los routers es donde se reconocen las peticiones y se ejecutan las funciones necesarias para devolver la respuesta adecuada. En este caso se han implementado los routers de usuario, ruta, reto y grupo.</p>

<a href="#usuario-1" id="usuario-1" style="color: inherit; text-decoration: none;">
  <h4>Usuario</h4>
</a>
<p>La implementación del router de usuario es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarioRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Usuario</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">filter</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">? {</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()} : {};</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuarios</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">usuarios</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-11">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuarios</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/users/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El usuario no se encuentra&quot;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;actividad&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas_favoritas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;retos_activos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;amigos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;grupos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;estadisticas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;historico_rutas&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/users/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;actividad&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas_favoritas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;retos_activos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;amigos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;grupos&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;estadisticas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;historico_rutas&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> =</span><br/><span class="hl-1">      </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">501</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/users&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">amigos:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">grupos:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">usuarios:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">participantes:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">clasificacion:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">usuarios:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario_final</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">usuarioRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/users/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">usuario</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">amigos:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">grupos:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">usuarios:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">participantes:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">clasificacion:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">usuarios:</span><span class="hl-1"> </span><span class="hl-4">usuario</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">usuario_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">usuario_final</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este código se puede observar que se han añadido las operaciones de borrado de usuarios, que se encargan de borrar el usuario de todas las listas en las que se encuentre, ya sea de amigos, grupos, rutas, etc. También se ha añadido la operación de borrado de un usuario por su id, que realiza la misma operación que la anterior pero con el id del usuario.
Se realizan las operaciones de insertar, modificar, borrar y obtener usuarios, tanto por su id como por su nombre.</p>

<a href="#rutas" id="rutas" style="color: inherit; text-decoration: none;">
  <h4>Rutas</h4>
</a>
<p>La implementación de las rutas se ha realizado de la siguiente manera:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutaRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Ruta</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">filter</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">? {</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()} : {};</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">rutas</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">rutas</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-11">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">rutas</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">ruta</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;La ruta no se encuentra&quot;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;calificacion&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;desnivel&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;longitud&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;geolocalizacion_inicio&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;geolocation_fin&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;tipo&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-4">ruta</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;calificacion&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;desnivel&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;longitud&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;geolocalizacion_inicio&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;geolocation_fin&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;tipo&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> =</span><br/><span class="hl-1">      </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">ruta</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">ruta</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta_final</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">rutaRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/tracks/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">ruta</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas_favoritas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">rutas:</span><span class="hl-1"> </span><span class="hl-4">ruta</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {}</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">ruta_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Ruta</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">ruta_final</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este código se puede observar que se han añadido las operaciones de borrado de rutas, que se encargan de borrar la ruta de todas las listas en las que se encuentre, ya sea de amigos, grupos, retos, etc. También se ha añadido la operación de borrado de una ruta por su id, que realiza la misma operación que la anterior pero con el id de la ruta.
También tiene las operaciones de insertar, modificar, borrar y obtener rutas, tanto por su id como por su nombre.</p>

<a href="#retos" id="retos" style="color: inherit; text-decoration: none;">
  <h4>Retos</h4>
</a>
<p>La implementación de los retos se ha realizado de la siguiente manera:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retoRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Reto</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">filter</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">? {</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()} : {};</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">retos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">retos</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-11">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">retos</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&quot;El reto no se encuentra&quot;</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;id&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;tipo&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;kilometros&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;id&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;tipo&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;kilometros&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;usuarios&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> =</span><br/><span class="hl-1">      </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">retos_activos:</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">      } </span><span class="hl-0">catch</span><span class="hl-1"> {}</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto_final</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">retoRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/challenges/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">reto</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Usuario</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">({}, {</span><span class="hl-4">$pull:</span><span class="hl-1"> {</span><span class="hl-4">retos_activos:</span><span class="hl-1"> </span><span class="hl-4">reto</span><span class="hl-1">.</span><span class="hl-4">_id</span><span class="hl-1">}});</span><br/><span class="hl-1">    } </span><span class="hl-0">catch</span><span class="hl-1"> {}</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">reto_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Reto</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">reto_final</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este código se puede observar que se han añadido las operaciones de borrado de retos, que se encargan de borrar el reto de todas las listas en las que se encuentre, ya sea de amigos, grupos, retos, etc. También se ha añadido la operación de borrado de un reto por su id, que realiza la misma operación que la anterior pero con el id del reto.
También tiene las operaciones de insertar, modificar, borrar y obtener retos, tanto por su id como por su nombre.</p>

<a href="#grupos" id="grupos" style="color: inherit; text-decoration: none;">
  <h4>Grupos</h4>
</a>
<p>La implementación de los grupos se ha realizado de la siguiente manera:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupoRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-2">new</span><span class="hl-1"> </span><span class="hl-7">Grupo</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">grupo</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">catch</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">filter</span><span class="hl-1"> = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">? {</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()} : {};</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupos</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1">(</span><span class="hl-4">grupos</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-11">0</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupos</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;El grupo no se encuentra&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;id&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;participantes&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;estadisticas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;clasificacion&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas_favoritas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;historico_rutas&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-5">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;id&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;participantes&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;estadisticas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;clasificacion&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;rutas_favoritas&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;historico_rutas&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">isValidUpdate</span><span class="hl-1"> =</span><br/><span class="hl-1">      </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Esta modificacion no esta permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">    }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-2">true</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-5">&#39;Se debe proporcionar un nombre&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  } </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">if</span><span class="hl-1">(!</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({</span><span class="hl-4">nombre:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nombre</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">()});</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo_final</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">grupoRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-5">&#39;/groups/:id&#39;</span><span class="hl-1">, </span><span class="hl-2">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo</span><span class="hl-1"> = </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-4">grupo</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">grupo_final</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-4">Grupo</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">grupo_final</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-11">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este código se puede observar que se han añadido las operaciones de borrado de grupos, que se encargan de borrar el grupo de todas las listas en las que se encuentre, ya sea de amigos, grupos, retos, etc. También se ha añadido la operación de borrado de un grupo por su id, que realiza la misma operación que la anterior pero con el id del grupo.
También tiene las operaciones de insertar, modificar, borrar y obtener grupos, tanto por su id como por su nombre.</p>

<a href="#implementación-de-la-app" id="implementación-de-la-app" style="color: inherit; text-decoration: none;">
  <h3>Implementación de la app</h3>
</a>
<p>La implementación de la app es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-7">express</span><span class="hl-1">();</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">rutaRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">usuarioRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">grupoRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">retoRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">defaultRouter</span><span class="hl-1">);</span>
</code></pre>
<p>En este código simplemente se seleccionan se le dice a la aplicación los routers a usar.A</p>

<a href="#implementación-del-index" id="implementación-del-index" style="color: inherit; text-decoration: none;">
  <h3>Implementación del index</h3>
</a>
<p>La implementación del index es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">port</span><span class="hl-1"> = </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-6">PORT</span><span class="hl-1">;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">listen</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">, () </span><span class="hl-2">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">`Server is up on port </span><span class="hl-2">${</span><span class="hl-4">port</span><span class="hl-2">}</span><span class="hl-5">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>En este código se le dice al servidor que se ejecute en el puerto que se le ha indicado en el fichero .env.</p>

<a href="#implementación-del-fichero-de-mongoose" id="implementación-del-fichero-de-mongoose" style="color: inherit; text-decoration: none;">
  <h3>Implementación del fichero de mongoose</h3>
</a>
<p>La implementación es la siguiente:</p>
<pre><code class="language-ts"><span class="hl-0">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-6">MONGODB_URL</span><span class="hl-1">!);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-5">&#39;Connection to MongoDB server established&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-0">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code></pre>
<p>En este código se le dice a la aplicación que se conecte a la base de datos de MongoDB.</p>

<a href="#conclusiones" id="conclusiones" style="color: inherit; text-decoration: none;">
  <h2>Conclusiones</h2>
</a>
<p>En esta práctica hemos aprendido a realizar un servidor haciendo uso de express y de mongoose, y a realizar las operaciones CRUD sobre una base de datos de MongoDB. También hemos aprendido a realizar un servidor que se conecte a una base de datos de MongoDB.
Esto es muy importante de cara al futuro ya que como programadores es muy interesante aprender a realizar un servidor y conectarlo con la base de datos.</p>

<a href="#bibliografía" id="bibliografía" style="color: inherit; text-decoration: none;">
  <h2>Bibliografía</h2>
</a>
<ul>
<li><a href="https://expressjs.com/es/">Express</a></li>
<li><a href="https://mongoosejs.com/">Mongoose</a></li>
<li><a href="https://www.mongodb.com/">MongoDB</a></li>
<li><a href="https://nodejs.org/es/">Node.js</a></li>
<li><a href="https://www.typescriptlang.org/">TypeScript</a></li>
</ul>
</div></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li class="current selected"><a href="modules.html">ull-<wbr/>esit-<wbr/>inf-<wbr/>dsi-<wbr/>22-<wbr/>23-<wbr/>prct12-<wbr/>destravate-<wbr/>api-<wbr/>grupoh</a>
<ul></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky"></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="assets/main.js"></script></body></html>